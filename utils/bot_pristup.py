import discord
from discord.ext import commands

class BotPristup(commands.Cog):
    def __init__(self, bot):
        self.bot = bot

    @commands.command(name="pridej_pristup_botovi")
    @commands.has_permissions(administrator=True)
    async def pridej_pristup_botovi(self, ctx):
        guild = ctx.guild
        bot_member = guild.me  # Bot jako member
        bot_role = bot_member.top_role  # Nejvyšší role bota

        predmetove_role_ids = [
            1383522736986656950, 1383522746167857202, 1383522758658490551, 1383522765092425788,
            1383522770130047036, 1383522776664637544, 1383522782343598082, 1383522787821355200,
            1383522811058061373, 1383522816938348655, 1383522822713905366, 1383522832356475024,
            1383522839239327874, 1383522843593015379, 1383522850505494710, 1383522873120919718,
            1383522880347832432, 1383522885339054150, 1383522890456240150, 1383522896760016928,
            1383522903387017348, 1383522928200515596, 1383522934236381270, 1383522938963365960,
            1383522943992074422, 1383522948928770060, 1383522973046149281, 1383522977982972125,
            1383522983007748237, 1383522988665868401, 1383522993510023238, 1383523017832796183,
            1383523024082309202, 1383523031275802735, 1383523036116025456, 1383523041195331737,
            1383523064125329470, 1383523070685352097, 1383523075852599340, 1383523082366615612,
            1383523088305623040, 1383523093741305916, 1383523100834009088, 1383523123667927061,
            1383523129187631164, 1383523134539436205, 1383523140612657273, 1383523151807385621,
            1383523157482279012, 1383523162569834657, 1383523187806965771, 1383523193213681846,
            1383523198024421466, 1383523204030529617, 1383523209252438036, 1383523232849858570,
            1383523238738399353, 1383523243293671515, 1383523249752641597, 1383523255461351555,
            1383523261652140254, 1383523285324664872, 1383523290894569553, 1383523297546735667,
            1383523302575964270, 1383523307407544320, 1383523335836667904, 1383523341624934400,
            1383523346985259088, 1383523352857284709, 1383523363644903566, 1383523370150395994,
            1383523376533999798, 1383523383354069114, 1383523406133067928, 1383523412047040552,
            1383523417436852425, 1383523425188053053, 1383523430476812289, 1383523437661913109,
            1383523443705643182, 1383523466522791956, 1383523471321202719, 1383523476710883398,
            1383523482142380124, 1383523489071501375, 1383523511775264952, 1383523516954968064,
            1383523527046467777, 1383523535057846332, 1383523540178964683, 1383523548106199120,
            1383523555203088394, 1383523560433385594, 1383523583682154576, 1383523588631429293,
            1383523595233529957, 1383523603206635701, 1383523609657606265, 1383523614548295884,
            1383523620239970535, 1383523643782332496, 1383523648480084039, 1383523660282859605,
            1383523666880626819, 1383523673499107358, 1383523678607773716, 1383523684073083002,
            1383523707049349192, 1383523711700963430, 1383523717388308480, 1383523724438933734,
            1383523732462637188, 1383523738137530481, 1383523742960849079, 1383523767312973887,
            1383523774015606886, 1383523779376058498, 1383523784681853069, 1383523789500973201,
            1383523811718332428, 1383523816948498566, 1383523822094782594, 1383523828252147833,
            1383523839031640066, 1383523844228386917, 1383523850318249985, 1383523872988729375,
            1383523879871578133, 1383523885223514195, 1383523890051153940, 1383523896912773202,
            1383523919276933192, 1383523931826163814, 1383523938696691712, 1383523944484573375,
            1383523951845703731, 1383523958267183165, 1383523963266662441, 1383523985966235699,
            1383523992068948011, 1383523999245533195, 1383524004664709242, 1383524015527952515,
            1383524020527566878, 1383524026944716981, 1383524033957466204, 1383524056506306601,
            1383524062730649610, 1383524068300685463, 1383524074332098700, 1383524086474604598,
            1383524100181594246, 1383524106296754218, 1383524112374173898, 1383524117936083045,
            1383524124521005136, 1383524129927463086, 1383524153377816586, 1383524160180977705,
            1383524167034343616, 1383524173510606872, 1383524181072941186, 1383524185770557564,
            1383524191525142550, 1383524215872815215, 1383524222881632389, 1383524234558701642,
            1383524240363491478, 1383524245534937229, 1383524251298168872, 1383524257115537540,
            1383524279978557510, 1383524286077210624, 1383524292691497061, 1383524302573539398,
            1383524307740790937, 1383524313344376832, 1383524320525160489, 1383524326426280017,
            1383524350879072466, 1383524356394586316, 1383524361805369367, 1383524367446708375,
            1383524372941115483, 1383524396743790653, 1383524402242523248, 1383524407938387978,
            1383524413596631070, 1383524421934911589, 1383524427681239190,
        ]
        

        upraveno = []

        for kanal in guild.channels:
            for role_id in predmetove_role_ids:
                role = guild.get_role(role_id)
                if not role:
                    continue

                overwrites = kanal.overwrites_for(role)
                if overwrites.view_channel:
                    bot_overwrite = kanal.overwrites_for(bot_role)
                    bot_overwrite.view_channel = True
                    try:
                        await kanal.set_permissions(bot_role, overwrite=bot_overwrite)
                        upraveno.append(kanal.name)
                    except discord.Forbidden:
                        await ctx.send(f"❌ Bot nemá právo upravit kanál: {kanal.name}")
                    except Exception as e:
                        await ctx.send(f"⚠️ Chyba u kanálu {kanal.name}: {e}")
                    break  # Stačí jedna role s přístupem

        if upraveno:
            await ctx.send(f"✅ Bot dostal přístup do kanálů: {', '.join(set(upraveno))}")
        else:
            await ctx.send("ℹ️ Nebyly nalezeny žádné kanály k úpravě.")

async def setup(bot):
    await bot.add_cog(BotPristup(bot))

